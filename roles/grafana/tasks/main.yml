---
- name: Render Grafana manifest from template
  ansible.builtin.template:
    src: grafana.yaml.j2
    dest: "/tmp/grafana.yaml"

- name: Deploy Grafana (with Zabbix datasource and dashboards)
  kubernetes.core.k8s:
    kubeconfig: "{{ kubeconfig_path }}"
    context: "{{ kube_context | default(omit) }}"
    namespace: "{{ zabbix_namespace }}"
    state: present
    src: "/tmp/grafana.yaml"
